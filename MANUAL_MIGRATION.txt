========================================
MANUAL MIGRATION INSTRUCTIONS
========================================

Since we can't connect directly to the database, please follow these steps:

STEP 1: Open your MySQL client (MySQL Workbench, phpMyAdmin, or command line)

STEP 2: Connect to your database with the credentials from your .env file

STEP 3: Run these SQL commands one by one:

-- Command 1: Check for existing duplicates
SELECT accountHolderName, COUNT(*) as count 
FROM bankaccounts 
GROUP BY accountHolderName 
HAVING COUNT(*) > 1;

-- Command 2: If duplicates exist, make them unique
UPDATE bankaccounts 
SET accountHolderName = CONCAT(accountHolderName, '_', id)
WHERE id IN (
    SELECT a.id FROM (
        SELECT id, accountHolderName,
               ROW_NUMBER() OVER (PARTITION BY accountHolderName ORDER BY id) as rn
        FROM bankaccounts
    ) a 
    WHERE a.rn > 1
);

-- Command 3: Add the unique constraint
ALTER TABLE bankaccounts 
ADD UNIQUE KEY uq_account_holder_name (accountHolderName);

-- Command 4: Verify the constraint was added
SHOW INDEX FROM bankaccounts WHERE Non_unique = 0 AND Key_name != 'PRIMARY';

STEP 4: Test the migration
-- Try inserting a test record (should work)
INSERT INTO bankaccounts (accountHolderName, accountNumber, bankName, accountType, openingBalance, closingBalance)
VALUES ('Test_User_1', 'TEST001', 'Same Bank', 'Deposit', 1000, 1000);

-- Try inserting duplicate holder (should fail)
INSERT INTO bankaccounts (accountHolderName, accountNumber, bankName, accountType, openingBalance, closingBalance)
VALUES ('Test_User_1', 'TEST002', 'Different Bank', 'Deposit', 2000, 2000);

-- Clean up test data
DELETE FROM bankaccounts WHERE accountHolderName LIKE 'Test_%';

========================================
EXPECTED RESULTS:
========================================
- Command 1: Should show no duplicates or the duplicates that exist
- Command 2: Should update any duplicates (if they exist)
- Command 3: Should succeed with
- Command 4: Should show the new unique constraint
- Test: First insert should work, second should fail with duplicate error

========================================
AFTER MIGRATION:
========================================
1. The server is already running on http://localhost:3001
2. Go to http://localhost:3001/bank-accounts
3. Try creating accounts:
   - Same bank name, different holders → SHOULD WORK
   - Same holder name, different banks → SHOULD FAIL

========================================
